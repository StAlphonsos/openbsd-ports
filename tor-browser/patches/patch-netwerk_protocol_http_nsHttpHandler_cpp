$OpenBSD$

diff -Nup mozilla-esr31/netwerk/protocol/http/nsHttpHandler.cpp tor-browser/netwerk/protocol/http/nsHttpHandler.cpp
--- netwerk/protocol/http/nsHttpHandler.cpp.orig	Mon Jan  5 23:07:57 2015
+++ netwerk/protocol/http/nsHttpHandler.cpp	Tue Feb 17 14:37:56 2015
@@ -346,6 +346,7 @@ nsHttpHandler::Init()
         mObserverService->AddObserver(this, NS_XPCOM_SHUTDOWN_OBSERVER_ID, true);
         mObserverService->AddObserver(this, "net:clear-active-logins", true);
         mObserverService->AddObserver(this, "net:prune-dead-connections", true);
+        mObserverService->AddObserver(this, "net:prune-all-connections", true);        
         mObserverService->AddObserver(this, "net:failed-to-process-uri-content", true);
         mObserverService->AddObserver(this, "last-pb-context-exited", true);
     }
@@ -1851,6 +1852,12 @@ nsHttpHandler::Observe(nsISupports *subject,
     else if (strcmp(topic, "net:prune-dead-connections") == 0) {
         if (mConnMgr) {
             mConnMgr->PruneDeadConnections();
+        }
+    }
+    else if (strcmp(topic, "net:prune-all-connections") == 0) {
+        if (mConnMgr) {
+           mConnMgr->DoShiftReloadConnectionCleanup(nullptr);
+           mConnMgr->PruneDeadConnections();
         }
     }
     else if (strcmp(topic, "net:failed-to-process-uri-content") == 0) {
