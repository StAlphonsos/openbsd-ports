$OpenBSD$

diff -Nup mozilla-esr31/security/pkix/lib/pkixbuild.cpp tor-browser/security/pkix/lib/pkixbuild.cpp
--- security/pkix/lib/pkixbuild.cpp.orig	Mon Jan  5 23:08:02 2015
+++ security/pkix/lib/pkixbuild.cpp	Tue Feb 17 14:37:56 2015
@@ -225,6 +225,30 @@ BuildForward(TrustDomain& trustDomain,
   }
 
   if (trustLevel == TrustDomain::TrustAnchor) {
+    ScopedCERTCertList certChain(CERT_NewCertList());
+    if (!certChain) {
+      PR_SetError(SEC_ERROR_NO_MEMORY, 0);
+      return MapSECStatus(SECFailure);
+    }
+
+    rv = subject.PrependNSSCertToList(certChain.get());
+    if (rv != Success) {
+      return rv;
+    }
+    BackCert* child = subject.childCert;
+    while (child) {
+      rv = child->PrependNSSCertToList(certChain.get());
+      if (rv != Success) {
+        return rv;
+      }
+      child = child->childCert;
+    }
+
+    SECStatus srv = trustDomain.IsChainValid(certChain.get());
+    if (srv != SECSuccess) {
+      return MapSECStatus(srv);
+    }
+
     // End of the recursion. Create the result list and add the trust anchor to
     // it.
     results = CERT_NewCertList();
